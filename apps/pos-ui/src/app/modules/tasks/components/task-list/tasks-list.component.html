<pos-card>
  <div class="h-full flex flex-col">
    <!-- Header Section -->
    <div
      class="flex gap-0 flex-col p-4 items-start md:gap-4 md:flex-row md:items-center justify-between"
    >
      <div class="flex flex-col justify-center align-between mb-4">
        <span class="text-xl font-bold">Dodane zadania</span>
        <p class="text-surface-500">
          Przeglądaj dodane wcześniej zadania i dodawaj nowe
        </p>
      </div>
      <div class="flex gap-2">
        <p-buttongroup class="text-nowrap">
          <p-button
            label="Dodaj"
            icon="pi pi-plus"
            size="small"
            (click)="addTask()"
          />
        </p-buttongroup>
      </div>
    </div>

    <!-- Kanban Board -->
    <div class="p-4 overflow-x-auto flex-1" cdkDropListGroup>
      <div class="flex gap-6 min-h-[500px] pb-4">
        <!-- Kanban Column -->
        <div
          class="flex-none w-80 flex flex-col bg-gray-50 rounded-xl p-4 min-w-[320px]"
          *ngFor="let column of columns"
        >
          <!-- Column Header -->
          <div
            class="flex items-center justify-between mb-4 pb-3 border-b-2 border-gray-200"
          >
            <h3 class="text-lg font-semibold text-gray-900">
              {{ column.title }}
            </h3>
            <span
              class="bg-gray-300 text-gray-700 px-3 py-1 rounded-xl text-sm font-semibold"
            >
              {{ column.tasks.length }}
            </span>
          </div>

          <!-- Task List -->
          <div
            cdkDropList
            [cdkDropListData]="column.tasks"
            class="flex-1 flex flex-col gap-3 p-2 rounded-lg min-h-[200px] transition-colors duration-200"
            [class.bg-gray-200]="column.tasks.length === 0"
            (cdkDropListDropped)="drop($event)"
          >
            <!-- Task Card -->
            <div
              class="task-card bg-white rounded-lg p-4 shadow-sm cursor-move transition-all duration-200 border border-gray-200 hover:shadow-md hover:-translate-y-0.5"
              *ngFor="let task of column.tasks"
              cdkDrag
            >
              <div class="flex flex-col gap-2">
                <!-- Task Header -->
                <div class="flex items-start justify-between gap-2">
                  <h4 class="text-base font-semibold text-gray-900 flex-1">
                    {{ task.title }}
                  </h4>
                  <span
                    class="px-2.5 py-1 rounded-xl text-xs font-semibold whitespace-nowrap flex-shrink-0"
                    [ngClass]="getPriorityClass(task.priority)"
                  >
                    {{ getPriorityLabel(task.priority) }}
                  </span>
                </div>
                <!-- Task Description -->
                <p class="text-sm text-gray-600 leading-relaxed">
                  {{ task.description }}
                </p>
              </div>

              <!-- Drag Preview -->
              <div
                class="task-card bg-white rounded-lg p-4 shadow-lg opacity-90 rotate-2 border border-gray-200"
                *cdkDragPreview
              >
                <div class="flex flex-col gap-2">
                  <div class="flex items-start justify-between gap-2">
                    <h4 class="text-base font-semibold text-gray-900 flex-1">
                      {{ task.title }}
                    </h4>
                    <span
                      class="px-2.5 py-1 rounded-xl text-xs font-semibold whitespace-nowrap flex-shrink-0"
                      [ngClass]="getPriorityClass(task.priority)"
                    >
                      {{ getPriorityLabel(task.priority) }}
                    </span>
                  </div>
                  <p class="text-sm text-gray-600 leading-relaxed">
                    {{ task.description }}
                  </p>
                </div>
              </div>

              <!-- Drag Placeholder -->
              <div
                class="bg-gray-200 border-2 border-dashed border-gray-400 rounded-lg min-h-[80px] transition-all duration-250"
                *cdkDragPlaceholder
              ></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</pos-card>
